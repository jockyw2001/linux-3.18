#include <stdio.h>
#include <stdlib.h>
#include <sys/ioctl.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <errno.h>
#include "cam_os_wrapper.h"
#include "mdrv_mipi_dsi_io_st.h"
#include "mdrv_mipi_dsi_io.h"

#define MIPI_DSI_DEVICE_NAME	"/dev/ms_mipi_dsi"

#define  RGB888_SYNC_PULSE_MODE  0
#define  RGB888_SYNC_EVENT_MODE  1
#define  RGB888_BURST_MODE  2
#define  RGB565_SYNC_PULSE_MODE  3
#define  RGB565_SYNC_EVENT_MODE  4
#define  RGB565_BURST_MODE  5
#define  RGB666_BURST_MODE  6
#define  VDO_MODE      (RGB888_SYNC_PULSE_MODE)

static s32 nDevFd=-1;

/*
	Note :
	Data ID will depends on the following rule.

		count of parameters > 1	=> Data ID = 0x39
		count of parameters = 1	=> Data ID = 0x15
		count of parameters = 0	=> Data ID = 0x05
	Structure Format :
	{DCS command, count of parameters, {parameter list}}
	{FLAG_DELAY, FLAG_DELAY, milliseconds of time},
	...
	Setting ending by predefined flag

	{FLAG_END_OF_TABLE, FLAG_END_OF_TABLE}
*/

unsigned char FITI_EK79030_Test_Pattern[] =
{
    0xCD,  1,  0xAA,     //FITI_EK79030_ENTER_CMD
    0x32,  1,  0x01,     //FITI_EK79030_Test_Pattern
    FLAG_END_OF_TABLE, FLAG_END_OF_TABLE
};

unsigned char FITI_EK79030_CMD[] =
{
    0xCD,  1,  0xAA,    //FITI_EK79030_ENTER_CMD
    0x65,  1,  0x08,    //FITI_EK79030_Tab1
    0x3A,  1,  0x14,    //FITI_EK79030_Tab2
    0x32,  1,  0x00,    //FITI_EK79030_Tab3
    0x36,  1,  0x02,    //FITI_EK79030_Tab4
    0x67,  1,  0x82,    //FITI_EK79030_Tab5
    0x69,  1,  0x20,    //FITI_EK79030_Tab6
    0x6D,  1,  0x01,    //FITI_EK79030_Tab7
    0x68,  1,  0x00,    //FITI_EK79030_Tab8
    0x53, 19,  0x1F,  0x19,  0x17,  0x09,
               0x09,  0x10,  0x14,  0x14,
               0x14,  0x09,  0x0a,  0x06,
               0x05,  0x08,  0x07,  0x09,
               0x06,  0x05,  0x04,         //FITI_EK79030_Tab9
    0x54, 19,  0x1F,  0x19,  0x16,  0x17,
               0x17,  0x12,  0x11,  0x14,
               0x14,  0x16,  0x08,  0x08,
               0x07,  0x07,  0x0a,  0x0B,
               0x08,  0x06,  0x06,  //FITI_EK79030_Tab10
    0x29,  1,  0x10,    //FITI_EK79030_Tab11
    0x2A,  1,  0x0C,    //FITI_EK79030_Tab12
    0x6C,  1,  0x81,    //FITI_EK79030_Tab13
    0x55,  8,  0x00,  0x0F,  0x00,  0x0F,
               0x00,  0x0F,  0x00,  0x0F,  //FITI_EK79030_Tab14
    0x55,  8,  0x00,  0x0F,  0x00,
               0x0F,  0x00,  0x0F,  0x00,
               0x0F,                       //FITI_EK79030_Tab15
    0x56, 16,  0x12,  0x1F,  0x12,
               0x1F,  0x12,  0x1F,  0x12,
               0x1F,  0x12,  0x1F,  0x12,
               0x1F,  0x12,  0x1F,  0x12,
               0x1f,                       //FITI_EK79030_Tab16
    0x57,  4,  0x00,  0x00,  0x00,  0x00,  //FITI_EK79030_Tab17
    0x30,  1,  0x00,    //FITI_EK79030_Tab18
    0x39,  1,  0x11,    //FITI_EK79030_Tab19
    0x33,  1,  0x08,    //FITI_EK79030_Tab20
    0x35,  1,  0x25,    //FITI_EK79030_Tab21
    0x4F,  1,  0x51,    //FITI_EK79030_Tab22
    0x4E,  1,  0x45,    //FITI_EK79030_Tab23
    0x41,  1,  0x4E,    //FITI_EK79030_Tab24, VCOM 0x4E
    0x73,  1,  0x30,    //FITI_EK79030_Tab25
    0x74,  1,  0x10,    //FITI_EK79030_Tab26
    0x76,  1,  0x40,    //FITI_EK79030_Tab27
    0x77,  1,  0x00,    //FITI_EK79030_Tab28
    0x28,  1,  0x31,    //FITI_EK79030_Tab29
    0x7C,  1,  0x80,    //FITI_EK79030_Tab30
    0x2E,  1,  0x04,    //FITI_EK79030_Tab31
    0x4C,  1,  0x80,    //FITI_EK79030_Tab32
    0x47,  1,  0x16,    //FITI_EK79030_Tab33
    0x48,  1,  0x6C,    //FITI_EK79030_Tab34
    0x50,  1,  0xC0,    //FITI_EK79030_Tab35
    0x78,  1,  0x6E,    //FITI_EK79030_Tab36
    0x2D,  1,  0x31,    //FITI_EK79030_Tab37
    0x63,  1,  0x04,    //FITI_EK79030_Tab38
    0x61,  1,  0x84,    //FITI_EK79030_Tab39
    0x4D,  1,  0x00,    //FITI_EK79030_EXIT_CMD
    FLAG_END_OF_TABLE, FLAG_END_OF_TABLE
};

unsigned char FITI_OTA7001A_Test_Pattern[] =
{
    0xFE, 1, 0x01,
    0x27, 1, 0x0A,
    0x29, 1, 0x0A,
    0x2B, 1, 0xE5,
    0x24, 1, 0xC0,
    0x25, 1, 0x53,
    0x26, 1, 0x00,
    0x16, 1, 0x52, //wrong
    0x2F, 1, 0x54,
    0x34, 1, 0x57,
    0x1B, 1, 0x00,
    0x12, 1, 0x0A,
    0x1A, 1, 0x06,
    0x46, 1, 0x4D,
    0x52, 1, 0x90,
    0x53, 1, 0x00,
    0x54, 1, 0x90,
    0x55, 1, 0x00,
    FLAG_DELAY, FLAG_DELAY, 200,
    0xFE, 1, 0x03,
    0x00, 1, 0x05,
    0x01, 1, 0x16,
    0x02, 1, 0x09,
    0x03, 1, 0x0D,
    0x04, 1, 0x00,
    0x05, 1, 0x00,
    0x06, 1, 0x50,
    0x07, 1, 0x05,
    0x08, 1, 0x16,
    0x09, 1, 0x0B,
    0x0A, 1, 0x0F,
    0x0B, 1, 0x00,
    0x0C, 1, 0x00,
    0x0D, 1, 0x50,
    0x0E, 1, 0x03,
    0x0F, 1, 0x04,
    0x10, 1, 0x05,
    0x11, 1, 0x06,
    0x12, 1, 0x00,
    0x13, 1, 0x54,
    0x14, 1, 0x00,
    0x15, 1, 0xC5,
    0x16, 1, 0x08,
    0x17, 1, 0x07,
    0x18, 1, 0x08,
    0x19, 1, 0x09,
    0x1A, 1, 0x0A,
    0x1B, 1, 0x00,
    0x1C, 1, 0x54,
    0x1D, 1, 0x00,
    0x1E, 1, 0x85,
    0x1F, 1, 0x08,
    0x20, 1, 0x00,
    0x21, 1, 0x00,
    0x22, 1, 0x03,
    0x23, 1, 0x1F,
    0x24, 1, 0x00,
    0x25, 1, 0x28,
    0x26, 1, 0x00,
    0x27, 1, 0x1F,
    0x28, 1, 0x00,
    0x29, 1, 0x28,
    0x2A, 1, 0x00,
    0x2B, 1, 0x00,
    0x2D, 1, 0x00,
    0x2F, 1, 0x00,
    0x30, 1, 0x00,
    0x31, 1, 0x00,
    0x32, 1, 0x00,
    0x33, 1, 0x00,
    0x34, 1, 0x00,
    0x35, 1, 0x00,
    0x36, 1, 0x00,
    0x37, 1, 0x00,
    0x38, 1, 0x00,
    0x39, 1, 0x00,
    0x3A, 1, 0x00,
    0x3B, 1, 0x00,
    0x3D, 1, 0x00,
    0x3F, 1, 0x00,
    0x40, 1, 0x00,
    0x3F, 1, 0x00,
    0x41, 1, 0x00,
    0x42, 1, 0x00,
    0x43, 1, 0x00,
    0x44, 1, 0x00,
    0x45, 1, 0x00,
    0x46, 1, 0x00,
    0x47, 1, 0x00,
    0x48, 1, 0x00,
    0x49, 1, 0x00,
    0x4A, 1, 0x00,
    0x4B, 1, 0x00,
    0x4C, 1, 0x00,
    0x4D, 1, 0x00,
    0x4E, 1, 0x00,
    0x4F, 1, 0x00,
    0x50, 1, 0x00,
    0x51, 1, 0x00,
    0x52, 1, 0x00,
    0x53, 1, 0x00,
    0x54, 1, 0x00,
    0x55, 1, 0x00,
    0x56, 1, 0x00,
    0x58, 1, 0x00,
    0x59, 1, 0x00,
    0x5A, 1, 0x00,
    0x5B, 1, 0x00,
    0x5C, 1, 0x00,
    0x5D, 1, 0x00,
    0x5E, 1, 0x00,
    0x5F, 1, 0x00,
    0x60, 1, 0x00,
    0x61, 1, 0x00,
    0x62, 1, 0x00,
    0x63, 1, 0x00,
    0x64, 1, 0x00,
    0x65, 1, 0x00,
    0x66, 1, 0x00,
    0x67, 1, 0x00,
    0x68, 1, 0x00,
    0x69, 1, 0x00,
    0x6A, 1, 0x00,
    0x6B, 1, 0x00,
    0x6C, 1, 0x00,
    0x6D, 1, 0x00,
    0x6E, 1, 0x00,
    0x6F, 1, 0x00,
    0x70, 1, 0x00,
    0x71, 1, 0x00,
    0x72, 1, 0x00,
    0x73, 1, 0x00,
    0x74, 1, 0x04,
    0x75, 1, 0x04,
    0x76, 1, 0x04,
    0x77, 1, 0x04,
    0x78, 1, 0x00,
    0x79, 1, 0x00,
    0x7A, 1, 0x00,
    0x7B, 1, 0x00,
    0x7C, 1, 0x00,
    0x7D, 1, 0x00,
    0x7E, 1, 0x86,
    0x7F, 1, 0x02,
    0x80, 1, 0x0E,
    0x81, 1, 0x0C,
    0x82, 1, 0x0A,
    0x83, 1, 0x08,
    0x84, 1, 0x3F,
    0x85, 1, 0x3F,
    0x86, 1, 0x3F,
    0x87, 1, 0x3F,
    0x88, 1, 0x3F,
    0x89, 1, 0x3F,
    0x8A, 1, 0x3F,
    0x8B, 1, 0x3F,
    0x8C, 1, 0x3F,
    0x8D, 1, 0x3F,
    0x8E, 1, 0x3F,
    0x8F, 1, 0x3F,
    0x90, 1, 0x00,
    0x91, 1, 0x04,
    0x92, 1, 0x3F,
    0x93, 1, 0x3F,
    0x94, 1, 0x3F,
    0x95, 1, 0x3F,
    0x96, 1, 0x05,
    0x97, 1, 0x01,
    0x98, 1, 0x3F,
    0x99, 1, 0x3F,
    0x9A, 1, 0x3F,
    0x9B, 1, 0x3F,
    0x9C, 1, 0x3F,
    0x9D, 1, 0x3F,
    0x9E, 1, 0x3F,
    0x9F, 1, 0x3F,
    0xA0, 1, 0x3F,
    0xA2, 1, 0x3F,
    0xA3, 1, 0x3F,
    0xA4, 1, 0x3F,
    0xA5, 1, 0x09,
    0xA6, 1, 0x0B,
    0xA7, 1, 0x0D,
    0xA9, 1, 0x0F,
    FLAG_DELAY, FLAG_DELAY, 10,
    0xAA, 1, 0x03, // wrong
    FLAG_DELAY, FLAG_DELAY, 10,
    0xAB, 1, 0x07, //wrong
    FLAG_DELAY, FLAG_DELAY, 10,
    0xAC, 1, 0x01,
    0xAD, 1, 0x05,
    0xAE, 1, 0x0D,
    0xAF, 1, 0x0F,
    0xB0, 1, 0x09,
    0xB1, 1, 0x0B,
    0xB2, 1, 0x3F,
    0xB3, 1, 0x3F,
    0xB4, 1, 0x3F,
    0xB5, 1, 0x3F,
    0xB6, 1, 0x3F,
    0xB7, 1, 0x3F,
    0xB8, 1, 0x3F,
    0xB9, 1, 0x3F,
    0xBA, 1, 0x3F,
    0xBB, 1, 0x3F,
    0xBC, 1, 0x3F,
    0xBD, 1, 0x3F,
    0xBE, 1, 0x07,
    0xBF, 1, 0x03,
    0xC0, 1, 0x3F,
    0xC1, 1, 0x3F,
    0xC2, 1, 0x3F,
    0xC3, 1, 0x3F,
    0xC4, 1, 0x02,
    0xC5, 1, 0x06,
    0xC6, 1, 0x3F,
    0xC7, 1, 0x3F,
    0xC8, 1, 0x3F,
    0xC9, 1, 0x3F,
    0xCA, 1, 0x3F,
    0xCB, 1, 0x3F,
    0xCC, 1, 0x3F,
    0xCD, 1, 0x3F,
    0xCE, 1, 0x3F,
    0xCF, 1, 0x3F,
    0xD0, 1, 0x3F,
    0xD1, 1, 0x3F,
    0xD2, 1, 0x0A,
    0xD3, 1, 0x08,
    0xD4, 1, 0x0E,
    0xD5, 1, 0x0C,
    0xD6, 1, 0x04,
    0xD7, 1, 0x00,
    0xDC, 1, 0x02,
    0xDE, 1, 0x10,
    FLAG_DELAY, FLAG_DELAY, 200,
    0xFE, 1, 0x04,
    0x60, 1, 0x00,
    0x61, 1, 0x0C,
    0x62, 1, 0x14,
    0x63, 1, 0x0F,
    0x64, 1, 0x08,
    0x65, 1, 0x15,
    0x66, 1, 0x0F,
    0x67, 1, 0x0B,
    0x68, 1, 0x17,
    0x69, 1, 0x0D,
    0x6A, 1, 0x10,
    0x6B, 1, 0x09,
    0x6C, 1, 0x0F,
    0x6D, 1, 0x11,
    0x6E, 1, 0x0B,
    0x6F, 1, 0x00,
    0x70, 1, 0x00,
    0x71, 1, 0x0C,
    0x72, 1, 0x14,
    0x73, 1, 0x0F,
    0x74, 1, 0x08,
    0x75, 1, 0x15,
    0x76, 1, 0x0F,
    0x77, 1, 0x0B,
    0x78, 1, 0x17,
    0x79, 1, 0x0D,
    0x7A, 1, 0x10,
    0x7B, 1, 0x09,
    0x7C, 1, 0x0F,
    0x7D, 1, 0x11,
    0x7E, 1, 0x0B,
    0x7F, 1, 0x00,
    FLAG_DELAY, FLAG_DELAY, 200,
    0xFE, 1, 0x0E,
    0x01, 1, 0x75,
    0x49, 1, 0x56,
    FLAG_DELAY, FLAG_DELAY, 200,
    0xFE, 1, 0x00,
    0x58, 1, 0xA9,
    0x11, 0, 0x00,
    FLAG_DELAY, FLAG_DELAY, 200,
    0x29, 0, 0x00,
    FLAG_DELAY, FLAG_DELAY, 200,
    0xFE, 1, 0x0E,
    0x35, 1, 0x80,
    FLAG_END_OF_TABLE, FLAG_END_OF_TABLE
};

unsigned char FITI_OTA7001A_CMD[] =
{
    0xFE, 1, 0x01,
    0x27, 1, 0x0A,
    0x29, 1, 0x0A,
    0x2B, 1, 0xE5,
    0x24, 1, 0xC0,
    0x25, 1, 0x53,
    0x26, 1, 0x00,
    0x16, 1, 0x52, //wrong
    0x2F, 1, 0x54,
    0x34, 1, 0x57,
    0x1B, 1, 0x00,
    0x12, 1, 0x0A,
    0x1A, 1, 0x06,
    0x46, 1, 0x4D,
    0x52, 1, 0x90,
    0x53, 1, 0x00,
    0x54, 1, 0x90,
    0x55, 1, 0x00,
    FLAG_DELAY, FLAG_DELAY, 200,
    0xFE, 1, 0x03,
    0x00, 1, 0x05,
    0x01, 1, 0x16,
    0x02, 1, 0x09,
    0x03, 1, 0x0D,
    0x04, 1, 0x00,
    0x05, 1, 0x00,
    0x06, 1, 0x50,
    0x07, 1, 0x05,
    0x08, 1, 0x16,
    0x09, 1, 0x0B,
    0x0A, 1, 0x0F,
    0x0B, 1, 0x00,
    0x0C, 1, 0x00,
    0x0D, 1, 0x50,
    0x0E, 1, 0x03,
    0x0F, 1, 0x04,
    0x10, 1, 0x05,
    0x11, 1, 0x06,
    0x12, 1, 0x00,
    0x13, 1, 0x54,
    0x14, 1, 0x00,
    0x15, 1, 0xC5,
    0x16, 1, 0x08,
    0x17, 1, 0x07,
    0x18, 1, 0x08,
    0x19, 1, 0x09,
    0x1A, 1, 0x0A,
    0x1B, 1, 0x00,
    0x1C, 1, 0x54,
    0x1D, 1, 0x00,
    0x1E, 1, 0x85,
    0x1F, 1, 0x08,
    0x20, 1, 0x00,
    0x21, 1, 0x00,
    0x22, 1, 0x03,
    0x23, 1, 0x1F,
    0x24, 1, 0x00,
    0x25, 1, 0x28,
    0x26, 1, 0x00,
    0x27, 1, 0x1F,
    0x28, 1, 0x00,
    0x29, 1, 0x28,
    0x2A, 1, 0x00,
    0x2B, 1, 0x00,
    0x2D, 1, 0x00,
    0x2F, 1, 0x00,
    0x30, 1, 0x00,
    0x31, 1, 0x00,
    0x32, 1, 0x00,
    0x33, 1, 0x00,
    0x34, 1, 0x00,
    0x35, 1, 0x00,
    0x36, 1, 0x00,
    0x37, 1, 0x00,
    0x38, 1, 0x00,
    0x39, 1, 0x00,
    0x3A, 1, 0x00,
    0x3B, 1, 0x00,
    0x3D, 1, 0x00,
    0x3F, 1, 0x00,
    0x40, 1, 0x00,
    0x3F, 1, 0x00,
    0x41, 1, 0x00,
    0x42, 1, 0x00,
    0x43, 1, 0x00,
    0x44, 1, 0x00,
    0x45, 1, 0x00,
    0x46, 1, 0x00,
    0x47, 1, 0x00,
    0x48, 1, 0x00,
    0x49, 1, 0x00,
    0x4A, 1, 0x00,
    0x4B, 1, 0x00,
    0x4C, 1, 0x00,
    0x4D, 1, 0x00,
    0x4E, 1, 0x00,
    0x4F, 1, 0x00,
    0x50, 1, 0x00,
    0x51, 1, 0x00,
    0x52, 1, 0x00,
    0x53, 1, 0x00,
    0x54, 1, 0x00,
    0x55, 1, 0x00,
    0x56, 1, 0x00,
    0x58, 1, 0x00,
    0x59, 1, 0x00,
    0x5A, 1, 0x00,
    0x5B, 1, 0x00,
    0x5C, 1, 0x00,
    0x5D, 1, 0x00,
    0x5E, 1, 0x00,
    0x5F, 1, 0x00,
    0x60, 1, 0x00,
    0x61, 1, 0x00,
    0x62, 1, 0x00,
    0x63, 1, 0x00,
    0x64, 1, 0x00,
    0x65, 1, 0x00,
    0x66, 1, 0x00,
    0x67, 1, 0x00,
    0x68, 1, 0x00,
    0x69, 1, 0x00,
    0x6A, 1, 0x00,
    0x6B, 1, 0x00,
    0x6C, 1, 0x00,
    0x6D, 1, 0x00,
    0x6E, 1, 0x00,
    0x6F, 1, 0x00,
    0x70, 1, 0x00,
    0x71, 1, 0x00,
    0x72, 1, 0x00,
    0x73, 1, 0x00,
    0x74, 1, 0x04,
    0x75, 1, 0x04,
    0x76, 1, 0x04,
    0x77, 1, 0x04,
    0x78, 1, 0x00,
    0x79, 1, 0x00,
    0x7A, 1, 0x00,
    0x7B, 1, 0x00,
    0x7C, 1, 0x00,
    0x7D, 1, 0x00,
    0x7E, 1, 0x86,
    0x7F, 1, 0x02,
    0x80, 1, 0x0E,
    0x81, 1, 0x0C,
    0x82, 1, 0x0A,
    0x83, 1, 0x08,
    0x84, 1, 0x3F,
    0x85, 1, 0x3F,
    0x86, 1, 0x3F,
    0x87, 1, 0x3F,
    0x88, 1, 0x3F,
    0x89, 1, 0x3F,
    0x8A, 1, 0x3F,
    0x8B, 1, 0x3F,
    0x8C, 1, 0x3F,
    0x8D, 1, 0x3F,
    0x8E, 1, 0x3F,
    0x8F, 1, 0x3F,
    0x90, 1, 0x00,
    0x91, 1, 0x04,
    0x92, 1, 0x3F,
    0x93, 1, 0x3F,
    0x94, 1, 0x3F,
    0x95, 1, 0x3F,
    0x96, 1, 0x05,
    0x97, 1, 0x01,
    0x98, 1, 0x3F,
    0x99, 1, 0x3F,
    0x9A, 1, 0x3F,
    0x9B, 1, 0x3F,
    0x9C, 1, 0x3F,
    0x9D, 1, 0x3F,
    0x9E, 1, 0x3F,
    0x9F, 1, 0x3F,
    0xA0, 1, 0x3F,
    0xA2, 1, 0x3F,
    0xA3, 1, 0x3F,
    0xA4, 1, 0x3F,
    0xA5, 1, 0x09,
    0xA6, 1, 0x0B,
    0xA7, 1, 0x0D,
    0xA9, 1, 0x0F,
    FLAG_DELAY, FLAG_DELAY, 10,
    0xAA, 1, 0x03, // wrong
    FLAG_DELAY, FLAG_DELAY, 10,
    0xAB, 1, 0x07, //wrong
    FLAG_DELAY, FLAG_DELAY, 10,
    0xAC, 1, 0x01,
    0xAD, 1, 0x05,
    0xAE, 1, 0x0D,
    0xAF, 1, 0x0F,
    0xB0, 1, 0x09,
    0xB1, 1, 0x0B,
    0xB2, 1, 0x3F,
    0xB3, 1, 0x3F,
    0xB4, 1, 0x3F,
    0xB5, 1, 0x3F,
    0xB6, 1, 0x3F,
    0xB7, 1, 0x3F,
    0xB8, 1, 0x3F,
    0xB9, 1, 0x3F,
    0xBA, 1, 0x3F,
    0xBB, 1, 0x3F,
    0xBC, 1, 0x3F,
    0xBD, 1, 0x3F,
    0xBE, 1, 0x07,
    0xBF, 1, 0x03,
    0xC0, 1, 0x3F,
    0xC1, 1, 0x3F,
    0xC2, 1, 0x3F,
    0xC3, 1, 0x3F,
    0xC4, 1, 0x02,
    0xC5, 1, 0x06,
    0xC6, 1, 0x3F,
    0xC7, 1, 0x3F,
    0xC8, 1, 0x3F,
    0xC9, 1, 0x3F,
    0xCA, 1, 0x3F,
    0xCB, 1, 0x3F,
    0xCC, 1, 0x3F,
    0xCD, 1, 0x3F,
    0xCE, 1, 0x3F,
    0xCF, 1, 0x3F,
    0xD0, 1, 0x3F,
    0xD1, 1, 0x3F,
    0xD2, 1, 0x0A,
    0xD3, 1, 0x08,
    0xD4, 1, 0x0E,
    0xD5, 1, 0x0C,
    0xD6, 1, 0x04,
    0xD7, 1, 0x00,
    0xDC, 1, 0x02,
    0xDE, 1, 0x10,
    FLAG_DELAY, FLAG_DELAY, 200,
    0xFE, 1, 0x04,
    0x60, 1, 0x00,
    0x61, 1, 0x0C,
    0x62, 1, 0x14,
    0x63, 1, 0x0F,
    0x64, 1, 0x08,
    0x65, 1, 0x15,
    0x66, 1, 0x0F,
    0x67, 1, 0x0B,
    0x68, 1, 0x17,
    0x69, 1, 0x0D,
    0x6A, 1, 0x10,
    0x6B, 1, 0x09,
    0x6C, 1, 0x0F,
    0x6D, 1, 0x11,
    0x6E, 1, 0x0B,
    0x6F, 1, 0x00,
    0x70, 1, 0x00,
    0x71, 1, 0x0C,
    0x72, 1, 0x14,
    0x73, 1, 0x0F,
    0x74, 1, 0x08,
    0x75, 1, 0x15,
    0x76, 1, 0x0F,
    0x77, 1, 0x0B,
    0x78, 1, 0x17,
    0x79, 1, 0x0D,
    0x7A, 1, 0x10,
    0x7B, 1, 0x09,
    0x7C, 1, 0x0F,
    0x7D, 1, 0x11,
    0x7E, 1, 0x0B,
    0x7F, 1, 0x00,
    FLAG_DELAY, FLAG_DELAY, 200,
    0xFE, 1, 0x0E,
    0x01, 1, 0x75,
    0x49, 1, 0x56,
    FLAG_DELAY, FLAG_DELAY, 200,
    0xFE, 1, 0x00,
    0x58, 1, 0xA9,
    0x11, 0, 0x00,
    FLAG_DELAY, FLAG_DELAY, 200,
    0x29, 0, 0x00,
    FLAG_DELAY, FLAG_DELAY, 200,
    FLAG_END_OF_TABLE, FLAG_END_OF_TABLE
};

static MipiDsiConfig_t _gtMipiDsiCfg[]=
{
    //[0]FITI_480x1280
    {
        {
            0x05, // HS_TRAIL
            0x03, // HS_PRPR
            0x05, // HS_ZERO
            0x0A,// CLK_HS_PRPR
            0xE, // CLK_HS_EXIT
            0x03, // CLK_TRAIL
            0x0b, // CLK_ZERO
            0x0A,// CLK_HS_POST
            0x05, // DA_HS_EXIT
            0x00,// CONT_DET
            0x03, // LPX
            0x1a,// TA_GET
            0x16,// TA_SURE
            0x32,// TA_GO
            0,
            0,
            0,
            0,
            #if  (VDO_MODE == RGB888_SYNC_PULSE_MODE)
            //HACT ,  HPW ,  HBP  ,  HFP ,     VACT ,     VPW,    VBP,    VFP,   BLLP,   fps,    lane number,   DSI format,                 DSI Mode
            480,      24,    187,    160,      1280,      2,      10,     12,    0,      60,     4,             DSI_FORMAT_RGB888,          DSI_SYNC_PULSE_MODE,
            #elif  (VDO_MODE == RGB888_BURST_MODE)
            480,      24,    187,    160,      1280,      2,      10,     12,    0,      60,     4,             DSI_FORMAT_RGB888,          DSI_BURST_MODE,
            #elif  (VDO_MODE == RGB666_BURST_MODE)
            480,      24,    240,    240,      1280,      2,      10,     14,    0,      60,     4,             DSI_FORMAT_RGB666,          DSI_BURST_MODE,
            #elif  (VDO_MODE == RGB565_BURST_MODE)
            480,      24,    240,    240,      1280,      2,      10,     12,    0,      60,     4,             DSI_FORMAT_RGB565,          DSI_BURST_MODE,
            #endif
        },
        sizeof(FITI_EK79030_CMD),
        (u32)(FITI_EK79030_CMD),
    },
    //[1]LCD_RM68200_720x1280_MIPI_DSI_4lane
    {
        {
            0x05, // HS_TRAIL
            0x03, // HS_PRPR
            0x05, // HS_ZERO
            0x0A,// CLK_HS_PRPR
            0xE, // CLK_HS_EXIT
            0x03, // CLK_TRAIL
            0x0b, // CLK_ZERO
            0x0A,// CLK_HS_POST
            0x05, // DA_HS_EXIT
            0x00,// CONT_DET
            0x10, // LPX
            0x1a,// TA_GET
            0x16,// TA_SURE
            0x32,// TA_GO
            0,
            0,
            0,
            0,
            #if  (VDO_MODE == RGB888_SYNC_PULSE_MODE)
            //HACT ,  HPW ,  HBP  ,  HFP ,     VACT ,     VPW,    VBP,    VFP,   BLLP,   fps,    lane number,   DSI format,                 DSI Mode
            720,       2,     40,      60,     1280,      4,      16,     16,    0,      60,     4,             DSI_FORMAT_RGB888,          DSI_SYNC_PULSE_MODE
            #elif  (VDO_MODE == RGB888_BURST_MODE)
            720,       2,     40,      60,     1280,      4,      16,     16,    0,      60,     4,             DSI_FORMAT_RGB888,          DSI_BURST_MODE
            #elif  (VDO_MODE == RGB666_BURST_MODE)
            720,       2,     40,      60,     1280,      4,      16,     16,    0,      60,     4,             DSI_FORMAT_RGB666,          DSI_BURST_MODE
            #elif  (VDO_MODE == RGB565_BURST_MODE)
            720,       2,     40,      60,     1280,      4,      16,     16,    0,      60,     4,             DSI_FORMAT_RGB565,          DSI_BURST_MODE
            #endif
        },
#if 0
        sizeof(FITI_OTA7001A_Test_Pattern),
        (u32)FITI_OTA7001A_Test_Pattern,
#else
        sizeof(FITI_OTA7001A_CMD),
        (u32)FITI_OTA7001A_CMD,
#endif
    },
};

static void DisplayMenuSetting(void)
{
    printf("===============================\n");
    printf("==            Menu           ==\n");
    printf("===============================\n");
    printf("=[r] Reset MIPI TX DSI\n");
    printf("=[s] Set MIPI TX DSI settings\n");
    //printf("=[g] Print the current MIPI TX DSI settings\n");
    //printf("=[o] On/Off MIPI TX DSI output\n");
    printf("=[a] Read register\n");
    printf("=[w] Write register\n");
    printf("=[b] Write register only one bit\n");
    printf("=[q] Quit\n");
    printf("===============================\n");
    printf("==>");
}

static void MipiDsiReset(void)
{
    s32 nRet=0;

    if ((nRet = ioctl(nDevFd, IOCTL_MIPI_DSI_RESET, NULL)) < 0)
        printf("ioctl %d fail, errno = %d\n", IOCTL_MIPI_DSI_RESET, errno);
}

static void MipiDsiSetConfig(void)
{
    s32 nRet=0;
    char szCmd[64];
    pMipiDsiConfig ptMipiDsiCfg=NULL;

    printf("===============================\n");
    printf("==      MIPI TX DSI Type     ==\n");
    printf("===============================\n");
    printf("=[1] FITI_480x1280\n");
    printf("=[2] LCD_RM68200_720x1280_MIPI_DSI_4lane\n");
    printf("=[q] quit\n");
    printf("===============================\n");
    printf("==>");

    scanf("%s", szCmd);
    switch(szCmd[0])
    {
        case '1':
            ptMipiDsiCfg = &_gtMipiDsiCfg[0];
            break;
        case '2':
            ptMipiDsiCfg = &_gtMipiDsiCfg[1];
            break;
        case 'q':
            break;
        default:
            printf("Unsupport LCD panel type : %c\n", szCmd[0]);
            nRet = -1;
            break;
    }

    if (nRet < 0)
        return;

    if (ptMipiDsiCfg != NULL && (nRet = ioctl(nDevFd, IOCTL_MIPI_DSI_SET_CONFIG, ptMipiDsiCfg)) < 0)
        printf("ioctl %d fail, errno = %d\n", IOCTL_MIPI_DSI_SET_CONFIG, errno);
}

static void MipiDsiEnable(void)
{
    s32 nRet=0;
    char szCmd[64];
    u8 nEnable;

    printf("===============================\n");
    printf("==      LCD Panel Output     ==\n");
    printf("===============================\n");
    printf("=[n] On\n");
    printf("=[f] Off\n");
    printf("===============================\n");
    printf("==>");
    scanf("%s", szCmd);
    switch(szCmd[0])
    {
        case 'n':
            nEnable = 1;;
            break;
        case 'f':
            nEnable = 0;
            break;
        default:
            printf("Unsupport LCD panel output : %c\n", szCmd[0]);
            nRet = -1;
            break;
    }

    if (nRet < 0)
        return;

    if ((nRet = ioctl(nDevFd, IOCTL_MIPI_DSI_ENABLE, &nEnable)) < 0)
        printf("ioctl %d fail, errno = %d\n", IOCTL_MIPI_DSI_ENABLE, errno);
}

static void MipiDsiReadReg(void)
{
    s32 nRet=0;
    MipiDsiReg_t tMipiDsiReg={0};

    printf("Please enter register address(hex):\n");
    printf("==>");

    scanf("%x", &tMipiDsiReg.nRegAddr);

    if ((nRet = ioctl(nDevFd, IOCTL_MIPI_DSI_READ_REG, &tMipiDsiReg)) < 0)
        printf("ioctl %d fail, errno = %d\n", IOCTL_MIPI_DSI_READ_REG, errno);

    printf("Register value: 0x%x\n", tMipiDsiReg.nRegVal);
}

static void MipiDsiWriteReg(void)
{
    s32 nRet=0;
    MipiDsiReg_t tMipiDsiReg;

    printf("Please enter register address(hex):\n");
    printf("==>");
    scanf("%x", &tMipiDsiReg.nRegAddr);

    printf("Please enter register value(hex):\n");
    printf("==>");
    scanf("%x", &tMipiDsiReg.nRegVal);

    if ((nRet = ioctl(nDevFd, IOCTL_MIPI_DSI_WRITE_REG, &tMipiDsiReg)) < 0)
        printf("ioctl %d fail, errno = %d\n", IOCTL_MIPI_DSI_WRITE_REG, errno);
}

static void MipiDsiWriteRegBit(void)
{
    s32 nRet=0;
    MipiDsiReg_t tMipiDsiReg;

    printf("Please enter register address(hex):\n");
    printf("==>");
    scanf("%x", &tMipiDsiReg.nRegAddr);

    printf("Please enter register value(0 or 1):\n");
    printf("==>");
    scanf("%x", &tMipiDsiReg.nRegVal);

    printf("Please enter register mask(hex):\n");
    printf("==>");
    scanf("%x", &tMipiDsiReg.nRegMask);

    if ((nRet = ioctl(nDevFd, IOCTL_MIPI_DSI_WRITE_REG_BIT, &tMipiDsiReg)) < 0)
        printf("ioctl %d fail, errno = %d\n", IOCTL_MIPI_DSI_WRITE_REG_BIT, errno);
}

int main(int argc, char *argv[])
{
    s32 nOpt;
    char szCmd[64];

    if ((nDevFd = open(MIPI_DSI_DEVICE_NAME, O_RDONLY)) < 0)
    {
        printf("%s open fail!\n", MIPI_DSI_DEVICE_NAME);
        return -1;
    }
#if 0
    printf("IOCTL_MIPI_DSI_RESET         = %x\n", IOCTL_MIPI_DSI_RESET);
    printf("IOCTL_MIPI_DSI_SET_CONFIG    = %x\n", IOCTL_MIPI_DSI_SET_CONFIG);
    printf("IOCTL_MIPI_DSI_ENABLE        = %x\n", IOCTL_MIPI_DSI_ENABLE);
    printf("IOCTL_MIPI_DSI_READ_REG      = %x\n", IOCTL_MIPI_DSI_READ_REG);
    printf("IOCTL_MIPI_DSI_WRITE_REG     = %x\n", IOCTL_MIPI_DSI_WRITE_REG);
    printf("IOCTL_MIPI_DSI_WRITE_REG_BIT = %x\n", IOCTL_MIPI_DSI_WRITE_REG_BIT);
#endif
    do
    {
        DisplayMenuSetting();
        scanf("%s", szCmd);
        switch(szCmd[0])
        {
            case 'r':
                MipiDsiReset();
                break;
            case 's':
                MipiDsiSetConfig();
                break;
            case 'o':
                MipiDsiEnable();
                break;
            case 'a':
                MipiDsiReadReg();
                break;
            case 'w':
                MipiDsiWriteReg();
                break;
            case 'b':
                MipiDsiWriteRegBit();
                break;
            case 'q':
                break;
            default:
                printf("Unsupported option: %c\n", szCmd[0]);
                break;
        }
        printf("\n");
    }
    while('q' != szCmd[0]);

    if (nDevFd > 0)
        close(nDevFd);

    return 0;
}
